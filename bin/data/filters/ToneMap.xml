<?xml version="1.0"?>
<filter>
    <textures>
        <luminanceBuffer bind="float" flags="target" mipmaps="0">R16_FLOAT</luminanceBuffer>
        <finalBuffer bind="float3" source="$standard" name="finalBuffer" />
    </textures>

    <buffers>
        <averageLuminanceBuffer size="1" flags="unorderedAccess">R32_FLOAT</averageLuminanceBuffer>
    </buffers>

    <passes>
        <CalculateLuminance mode="deferred" entry="mainPixelProgram">
            <resources>
                <finalBuffer />
            </resources>

            <targets>
                <luminanceBuffer />
            </targets>
        </CalculateLuminance>

        <AdaptLuminance mode="compute" width="1" height="1" depth="1" entry="mainComputeProgram">
            <resources>
                <luminanceBuffer actions="generateMipMaps" />
            </resources>

            <unorderedaccess>
                <averageLuminanceBuffer />
            </unorderedaccess>
        </AdaptLuminance>

        <ToneMap mode="deferred" entry="mainPixelProgram">
            <resources>
                <finalBuffer />
                <averageLuminanceBuffer />
            </resources>
        </ToneMap>
    </passes>
</filter>
