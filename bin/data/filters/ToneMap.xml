<?xml version="1.0"?>
<filter>
    <textures>
        <luminanceBuffer bind="float" flags="target" mipmaps="0">R16_FLOAT</luminanceBuffer>
    </textures>

    <buffers>
        <averageLuminanceBuffer size="1" flags="unorderedAccess">R32_FLOAT</averageLuminanceBuffer>
    </buffers>

    <passes>
        <CalculateLuminance mode="deferred" entry="mainPixelProgram">
            <resources>
                <screen />
            </resources>

            <targets>
                <luminanceBuffer />
            </targets>
        </CalculateLuminance>

        <AdaptLuminance compute="(1, 1, 1)" entry="mainComputeProgram">
            <defines>
                <adaptionRate>1.25</adaptionRate>
            </defines>

            <resources>
                <luminanceBuffer actions="generateMipMaps" />
            </resources>

            <unorderedaccess>
                <averageLuminanceBuffer />
            </unorderedaccess>
        </AdaptLuminance>

        <ToneMap entry="mainPixelProgram">
            <defines>
                <techniqueMode type="int">6</techniqueMode>
                <autoExposureMode type="int">2</autoExposureMode>

                <luminanceSaturation>1.0</luminanceSaturation>
                <keyValue>0.18</keyValue>
                <exposure>0.0</exposure>
                <whiteLevel>5.0</whiteLevel>
                <bias>0.5</bias>

                <!-- Uncharted 2 Filmic ALU Defines -->
                <shoulderStrength>0.22</shoulderStrength>
                <linearStrength>0.3</linearStrength>
                <linearAngle>0.1</linearAngle>
                <toeStrength>0.2</toeStrength>
                <toeNumerator>0.01</toeNumerator>
                <toeDenominator>0.3</toeDenominator>
                <linearWhite>11.2</linearWhite>
            </defines>

            <resources>
                <averageLuminanceBuffer />
                <screenBuffer copy="screen" />
            </resources>

            <targets>
                <screen />
            </targets>
        </ToneMap>
    </passes>
</filter>
