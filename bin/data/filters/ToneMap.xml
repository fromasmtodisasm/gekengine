<?xml version="1.0"?>
<filter>
    <textures>
        <luminanceBuffer bind="float" flags="target" mipmaps="0">R16_FLOAT</luminanceBuffer>
        <finalBuffer bind="float3" source="standard" name="finalBuffer" />
    </textures>

    <buffers>
        <averageLuminanceBuffer size="1" flags="unorderedAccess">R32_FLOAT</averageLuminanceBuffer>
    </buffers>

    <pass mode="deferred">
        <resources>
            <finalBuffer />
        </resources>

        <targets>
            <luminanceBuffer />
        </targets>

        <program>
            <entry>mainPixelProgram</entry>
            <source>ToneMap\CalculateLuminance</source>
        </program>
    </pass>

    <pass mode="compute">
        <resources>
            <luminanceBuffer actions="generateMipMaps" />
        </resources>

        <unorderedaccess>
            <averageLuminanceBuffer />
        </unorderedaccess>

        <program>
            <compute>
                <width>1</width>
                <height>1</height>
                <depth>1</depth>
            </compute>
            <entry>mainPixelProgram</entry>
            <source>ToneMap\AdaptLuminance</source>
        </program>
    </pass>

    <pass mode="deferred">
        <resources>
            <finalBuffer />
            <averageLuminanceBuffer />
        </resources>

        <program>
            <entry>mainPixelProgram</entry>
            <source>ToneMap\ToneMap</source>
        </program>
    </pass>
</filter>
