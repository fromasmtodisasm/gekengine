<?xml version="1.0"?>
<shader priority="10">
    <material>
        <maps>
            <albedo bind="float4" default="*color:(1,1,1,1)">Texture2D</albedo>
        </maps>
    </material>

    <textures>
        <blendBuffer bind="float4" flags="target">half4</blendBuffer>
        <weightBuffer bind="float" flags="target">byte</weightBuffer>
    </textures>
    
    <depth source="standard:depth" />

    <block>
        <clear>
            <blendBuffer>(0,0,0,0)</blendBuffer>
            <weightBuffer>1</weightBuffer>
        </clear>

        <pass mode="forward">
            <depthstates>
                <comparison>less</comparison>
                <writemask>zero</writemask>
            </depthstates>

            <blendstates>
                <target>
                    <color source="one" destination="one" operation="add" />
                    <writemask>rgba</writemask>
                </target>
                <target>
                    <color source="zero" destination="inverse_source_color" operation="add" />
                    <writemask>r</writemask>
                </target>
            </blendstates>

            <renderstates>
                <cullmode>back</cullmode>
            </renderstates>

            <targets>
                <blendBuffer />
                <weightBuffer />
            </targets>
            
            <program>
                <entry>mainPixelProgram</entry>
                <source>Transparent\Prepare</source>
            </program>
        </pass>

        <pass mode="deferred">
            <blendstates>
                <color source="inverse_source_alpha" destination="source_alpha" operation="add" />
                <writemask>rgb</writemask>
            </blendstates>

            <resources>
                <blendBuffer />
                <weightBuffer />
            </resources>

            <program>
                <entry>mainPixelProgram</entry>
                <source>Transparent\Present</source>
            </program>
        </pass>
    </block>
</shader>
