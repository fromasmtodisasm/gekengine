<?xml version="1.0"?>
<shader priority="2">
    <material>
        <transparent>
            <albedo bind="float4" pattern="color" parameters="(1,1,1,1)">Texture2D</albedo>
        </transparent>
    </material>

    <textures>
        <accumulationBuffer bind="float4" flags="target">R16G16B16A16_FLOAT</accumulationBuffer>
        <modulationDiffusionBuffer bind="float4" flags="target">R8G8B8A8_UNORM</modulationDiffusionBuffer>
        <refractionBuffer bind="float2" flags="target">R16G16_FLOAT</refractionBuffer>
        <depthBuffer bind="float">R32_FLOAT</depthBuffer>
        <finalBuffer bind="float3" source="standard" name="finalBuffer" />
        <sourceBuffer bind="float3">R11G11B10_FLOAT</sourceBuffer>
    </textures>

    <depth source="standard" />

    <block>
        <clear>
            <accumulationBuffer type="target">0</accumulationBuffer>
            <modulationDiffusionBuffer type="target">(1,1,1,0)</modulationDiffusionBuffer>
            <refractionBuffer type="target">0</refractionBuffer>
        </clear>

        <pass mode="forward" name="transparent">
            <blendstates unified="false">
                <accumulationBuffer>
                    <color source="one" destination="one" operation="add" />
                    <alpha source="one" destination="one" operation="add" />
                </accumulationBuffer>
                <modulationDiffusionBuffer>
                    <color source="zero" destination="inverse_source_color" operation="add" />
                    <alpha source="one" destination="one" operation="add" />
                </modulationDiffusionBuffer>
                <refractionBuffer>
                    <color source="one" destination="one" operation="add" />
                    <alpha source="one" destination="one" operation="add" />
                </refractionBuffer>
            </blendstates>

            <renderstates>
                <cullmode>back</cullmode>
            </renderstates>

            <depthstates>
                <comparison>less</comparison>
                <writemask>zero</writemask>
            </depthstates>

            <targets>
                <accumulationBuffer />
                <modulationDiffusionBuffer />
                <refractionBuffer />
            </targets>

            <resources>
                <depthBuffer copy="depth" />
            </resources>

            <program entry="mainPixelProgram">Transparent\Calculate</program>
        </pass>

        <pass mode="deferred">
            <resources>
                <accumulationBuffer />
                <modulationDiffusionBuffer />
                <refractionBuffer />
                <sourceBuffer copy="finalBuffer" />
            </resources>

            <targets>
                <finalBuffer />
            </targets>

            <program entry="mainPixelProgram">Transparent\Combine</program>
        </pass>
    </block>
</shader>
