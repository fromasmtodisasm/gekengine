<?xml version="1.0"?>
<shader>
    <defines>
        <lightTileSize>32</lightTileSize>
		<lightListSize>256</lightListSize>
    </defines>

    <depth>D32</depth>

    <targets>
        <albedo>RGBA_UINT8</albedo>
        <normal>RG_HALF</normal>
        <depth>R_FLOAT</depth> 
        <info>RGBA_UINT8</info>
    </targets>

    <buffers>
        <tileIndices size="ceil(%shaderWidth% / %lightTileSize%) * ceil(%shaderWidth% / %lightTileSize%) * %lightListSize%">R_UINT8</tileIndices>
        <lightList size="%lightListSize%">LIGHT</lightList>
    </buffers>

    <material>
        <maps>
            <albedo />
            <normal />
            <info />
        </maps>
        <properties>
            <color>float4</color>
        </properties>
    </material>

    <pass mode="forward">
		<depthstates>
			<comparison>lessequal</comparison>
			<writemask>all</writemask>
			<clear>1</clear>
		</depthstates>

        <renderstates>
			<cullmode>back</cullmode>
		</renderstates>

        <targets>
            <albedo />
            <normal />
            <depth />
            <info />
        </targets>

        <pixel>
            <program source="Standard\Deferred" entry="mainPixelProgram" />
        </pixel>
    </pass>

    <pass mode="lighting">
        <blendstates>
			<target>
				<color source="one" destination="one" operation="add" />
				<alpha source="one" destination="one" operation="add" />
			</target>
        </blendstates>

        <compute dispatch="ceil(%viewWidth% / %lightTileSize%), ceil(%viewWidth% / %lightTileSize%), 1">
            <resources>
                <lightList />
                <depth />
            </resources>

            <unorderedaccess>
                <tileIndices />
            </unorderedaccess>

            <program source="Standard\Lighting" entry="mainComputeProgram" />
        </compute>

        <pixel>
            <resources>
                <lightList />
                <tileIndices />
                <albedo />
                <normal />
                <depth />
                <info />
            </resources>

            <program source="Standard\Lighting" entry="mainPixelProgram" />
        </pixel>
    </pass>
</shader>
